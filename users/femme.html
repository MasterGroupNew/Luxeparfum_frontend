<!DOCTYPE html>
<html lang="fr">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Parfums Femme - √âl√©gance Parfum√©e</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üå∏</text></svg>">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    .hero-bg {
      background: linear-gradient(rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.6)),
        url('https://images.unsplash.com/photo-1594035910387-f35580358dc8?ixlib=rb-4.0.3&auto=format&fit=crop&w=880&q=80');
      background-size: cover;
      background-position: center;
    }

    /* Panier */
    .cart-sidebar {
      transform: translateX(100%);
      transition: transform 0.3s ease-in-out;
    }

    .cart-sidebar.open {
      transform: translateX(0);
    }

    .cart-overlay {
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease-in-out;
    }

    .cart-overlay.open {
      opacity: 1;
      visibility: visible;
    }

    /* Menu mobile */
    #mobile-menu {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease-in-out;
    }

    #mobile-menu:not(.hidden) {
      max-height: 600px;
    }

    @media (max-width: 768px) {
      #productsContainer {
        grid-template-columns: repeat(1, 1fr);
        gap: 1rem;
      }

      .desktop-filters {
        display: none;
      }

      .cart-sidebar {
        width: 100%;
      }
    }

    @media (min-width: 769px) {
      .desktop-filters {
        display: flex;
      }

      .cart-sidebar {
        width: 400px;
      }
    }
  </style>
</head>

<body class="bg-gray-50 font-sans">

  <!-- Header -->
  <header class="bg-white shadow-sm sticky top-0 z-50">
    <div class="container mx-auto px-4 py-3 flex justify-between items-center">
      <div class="flex items-center space-x-2">
        <i class="fas fa-spray-can text-2xl text-purple-600"></i>
        <h1 class="text-xl font-bold text-gray-800">√âl√©gance Parfum√©e</h1>
      </div>

      <!-- Navigation Desktop -->
      <nav class="hidden md:flex space-x-8">
        <a href="./index.html" class="text-gray-700 hover:text-purple-600 transition">
          <i class="fas fa-home mr-1"></i>Accueil
        </a>
        <a href="./homme.html" class="text-gray-700 hover:text-purple-600 transition">
          <i class="fas fa-male mr-1"></i>Homme
        </a>
        <a href="./femme.html" class="text-purple-600 font-semibold transition">
          <i class="fas fa-female mr-1"></i>Femme
        </a>
        <a href="./collections.html" class="text-gray-700 hover:text-purple-600 transition">
          <i class="fas fa-th-large mr-1"></i>Collections
        </a>
        <a href="./apropos.html" class="text-gray-700 hover:text-purple-600 transition">
          <i class="fas fa-info-circle mr-1"></i>√Ä propos
        </a>
        
        <!-- Liens authentifi√©s (Desktop) -->
        <a href="./profile.html" id="profile-link" class="text-gray-700 hover:text-purple-600 transition hidden">
          <i class="fas fa-user mr-1"></i>Profil
        </a>
        <a href="./historique.html" id="historique-link" class="text-gray-700 hover:text-purple-600 transition hidden">
          <i class="fas fa-history mr-1"></i>Historique
        </a>
        <a href="./suivi.html" id="suivi-link" class="text-gray-700 hover:text-purple-600 transition hidden">
          <i class="fas fa-shipping-fast mr-1"></i>Suivi
        </a>
        <a href="#" id="logout-link" class="text-gray-700 hover:text-purple-600 transition hidden">
          <i class="fas fa-sign-out-alt mr-1"></i>D√©connexion
        </a>
        
        <!-- Lien connexion (Desktop) -->
        <a href="../utils/login.html" id="login-link" class="text-gray-700 hover:text-purple-600 transition">
          <i class="fas fa-sign-in-alt mr-1"></i>Connexion
        </a>
      </nav>

      <!-- Actions -->
      <div class="flex items-center space-x-4">
        <button id="search-btn" class="text-gray-600 hover:text-purple-600 transition">
          <i class="fas fa-search"></i>
        </button>
        <button id="cart-btn" class="relative text-gray-600 hover:text-purple-600 transition">
          <i class="fas fa-shopping-cart"></i>
          <span id="cart-count" class="absolute -top-2 -right-2 bg-purple-600 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">0</span>
        </button>
        <button class="md:hidden text-gray-600" id="mobile-menu-btn">
          <i class="fas fa-bars text-xl"></i>
        </button>
      </div>
    </div>

    <!-- Menu Mobile -->
    <div id="mobile-menu" class="hidden md:hidden bg-white py-2 px-4 shadow-md">
      <a href="./index.html" class="block py-2 text-gray-700 hover:text-purple-600 transition">
        <i class="fas fa-home mr-2"></i>Accueil
      </a>
      <a href="./homme.html" class="block py-2 text-gray-700 hover:text-purple-600 transition">
        <i class="fas fa-male mr-2"></i>Homme
      </a>
      <a href="./femme.html" class="block py-2 text-purple-600 font-semibold transition">
        <i class="fas fa-female mr-2"></i>Femme
      </a>
      <a href="./collections.html" class="block py-2 text-gray-700 hover:text-purple-600 transition">
        <i class="fas fa-th-large mr-2"></i>Collections
      </a>
      <a href="./apropos.html" class="block py-2 text-gray-700 hover:text-purple-600 transition">
        <i class="fas fa-info-circle mr-2"></i>√Ä propos
      </a>
      
      <!-- S√©parateur -->
      <div class="border-t border-gray-200 my-2"></div>
      
      <!-- Liens authentifi√©s (Mobile) -->
      <a href="./profile.html" id="profile-link-mobile" class="block py-2 text-gray-700 hover:text-purple-600 transition hidden">
        <i class="fas fa-user mr-2"></i>Profil
      </a>
      <a href="./historique.html" id="historique-link-mobile" class="block py-2 text-gray-700 hover:text-purple-600 transition hidden">
        <i class="fas fa-history mr-2"></i>Historique
      </a>
      <a href="./suivi.html" id="suivi-link-mobile" class="block py-2 text-gray-700 hover:text-purple-600 transition hidden">
        <i class="fas fa-shipping-fast mr-2"></i>Suivi
      </a>
      <a href="#" id="logout-link-mobile" class="block py-2 text-red-600 hover:text-red-800 transition hidden">
        <i class="fas fa-sign-out-alt mr-2"></i>D√©connexion
      </a>
      
      <!-- Lien connexion (Mobile) -->
      <a href="../utils/login.html" id="login-link-mobile" class="block py-2 text-purple-600 hover:text-purple-800 font-semibold transition">
        <i class="fas fa-sign-in-alt mr-2"></i>Connexion
      </a>
    </div>

    <!-- Search Bar -->
    <div id="search-bar" class="hidden bg-white py-3 px-4 shadow-md">
      <div class="container mx-auto flex">
        <input type="text" placeholder="Rechercher un parfum..." class="flex-grow px-4 py-2 border border-gray-300 rounded-l focus:outline-none focus:ring-2 focus:ring-purple-500">
        <button class="bg-purple-600 text-white px-4 py-2 rounded-r hover:bg-purple-700 transition">
          <i class="fas fa-search"></i>
        </button>
      </div>
    </div>
  </header>

  <!-- Hero -->
  <section class="hero-bg text-white py-20 md:py-32 text-center">
    <h2 class="text-4xl md:text-6xl font-bold mb-4">Parfums Femme</h2>
    <p class="text-xl md:text-2xl mb-8">Des fragrances envo√ªtantes pour la femme d'aujourd'hui</p>
  </section>

  <!-- Produits -->
  <section class="py-16 bg-gray-50">
    <div class="container mx-auto px-4">
      <div class="flex justify-between items-center mb-8">
        <h2 class="text-3xl font-bold text-gray-800">Notre collection Femme</h2>
        <div class="space-x-4 desktop-filters">
          <select id="sortSelect" class="border rounded px-3 py-2">
            <option value="">Trier par</option>
            <option value="prixAsc">Prix croissant</option>
            <option value="prixDesc">Prix d√©croissant</option>
          </select>
          <select id="categorySelect" class="border rounded px-3 py-2">
            <option value="">Famille olfactive</option>
            <option value="Floral">Floral</option>
            <option value="Oriental">Oriental</option>
            <option value="Bois√©">Bois√©</option>
            <option value="Frais">Frais</option>
          </select>
        </div>
      </div>

      <div id="productsContainer" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8">
        <div class="col-span-full py-12 text-center text-gray-500">
          <i class="fas fa-spinner fa-spin text-3xl mb-3"></i>
          <p>Chargement des parfums...</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="bg-gray-900 text-white py-12">
    <div class="container mx-auto px-4">
      <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
        <div>
          <div class="flex items-center space-x-2 mb-4">
            <i class="fas fa-spray-can text-2xl text-purple-400"></i>
            <h3 class="text-xl font-bold">√âl√©gance Parfum√©e</h3>
          </div>
          <p class="text-gray-400">Depuis 2010, nous cr√©ons des fragrances uniques qui subliment votre personnalit√©.</p>
        </div>

        <div>
          <h4 class="text-lg font-semibold mb-4">Boutique</h4>
          <ul class="space-y-2 text-gray-400">
            <li><a href="./index.html" class="hover:text-white transition">Nouveaut√©s</a></li>
            <li><a href="./homme.html" class="hover:text-white transition">Parfums homme</a></li>
            <li><a href="./femme.html" class="hover:text-white transition">Parfums femme</a></li>
            <li><a href="./collections.html" class="hover:text-white transition">Collections</a></li>
          </ul>
        </div>

        <div>
          <h4 class="text-lg font-semibold mb-4">Contact</h4>
          <ul class="space-y-2 text-gray-400">
            <li class="flex items-center">
              <i class="fas fa-map-marker-alt mr-2"></i>
              <span>Cocody, Abidjan, C√¥te d'Ivoire</span>
            </li>
            <li class="flex items-center">
              <i class="fas fa-phone-alt mr-2"></i>
              <span>+225 07 07 07 07 07</span>
            </li>
            <li class="flex items-center">
              <i class="fas fa-envelope mr-2"></i>
              <span>contact@luxeparfum.ci</span>
            </li>
          </ul>
        </div>
      </div>

      <div class="border-t border-gray-700 mt-8 pt-6 text-center">
        <p class="text-gray-400 text-sm">¬© 2024 √âl√©gance Parfum√©e. Tous droits r√©serv√©s.</p>
      </div>
    </div>
  </footer>

  <!-- Panier Sidebar -->
  <div id="cart-overlay" class="cart-overlay fixed inset-0 bg-black bg-opacity-50 z-40"></div>

  <div id="cart-sidebar" class="cart-sidebar fixed top-0 right-0 h-full bg-white z-50 overflow-y-auto">
    <div class="p-6">
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-bold text-gray-800">Mon Panier</h2>
        <button id="close-cart" class="text-gray-500 hover:text-gray-700">
          <i class="fas fa-times text-xl"></i>
        </button>
      </div>

      <div id="cart-content">
        <div id="empty-cart" class="text-center py-12">
          <i class="fas fa-shopping-cart text-4xl text-gray-300 mb-4"></i>
          <p class="text-gray-500">Votre panier est vide</p>
        </div>

        <div id="cart-items" class="hidden"></div>
      </div>

      <div id="cart-summary" class="hidden border-t border-gray-200 pt-4 mt-4">
        <div class="flex justify-between items-center mb-4">
          <span class="text-lg font-semibold">Total:</span>
          <span id="cart-total" class="text-lg font-bold text-purple-600">0 FCFA</span>
        </div>

        <button id="checkout-btn" class="w-full bg-purple-600 text-white py-3 rounded-lg hover:bg-purple-700 transition duration-300">
          Commander maintenant
        </button>

        <button id="continue-shopping" class="w-full border border-gray-300 text-gray-700 py-3 rounded-lg hover:bg-gray-50 transition duration-300 mt-2">
          Continuer mes achats
        </button>
      </div>
    </div>
  </div>

  <!-- Script principal -->
  <script>
    document.addEventListener("DOMContentLoaded", async () => {
      const token = localStorage.getItem("token");

      // =====================
      // GESTION DE L'AUTHENTIFICATION
      // =====================
      const profileLink = document.getElementById('profile-link');
      const historiqueLink = document.getElementById('historique-link');
      const suiviLink = document.getElementById('suivi-link');
      const logoutLink = document.getElementById('logout-link');
      const loginLink = document.getElementById('login-link');
      
      const profileLinkMobile = document.getElementById('profile-link-mobile');
      const historiqueLinkMobile = document.getElementById('historique-link-mobile');
      const suiviLinkMobile = document.getElementById('suivi-link-mobile');
      const logoutLinkMobile = document.getElementById('logout-link-mobile');
      const loginLinkMobile = document.getElementById('login-link-mobile');

      function handleLogout(e) {
        e.preventDefault();
        if (confirm('√ätes-vous s√ªr de vouloir vous d√©connecter ?')) {
          localStorage.clear();
          window.location.href = '../visiteur.html';
        }
      }

      if (token) {
        // Utilisateur connect√©
        profileLink?.classList.remove('hidden');
        historiqueLink?.classList.remove('hidden');
        suiviLink?.classList.remove('hidden');
        logoutLink?.classList.remove('hidden');
        loginLink?.classList.add('hidden');
        
        profileLinkMobile?.classList.remove('hidden');
        historiqueLinkMobile?.classList.remove('hidden');
        suiviLinkMobile?.classList.remove('hidden');
        logoutLinkMobile?.classList.remove('hidden');
        loginLinkMobile?.classList.add('hidden');
        
        logoutLink?.addEventListener('click', handleLogout);
        logoutLinkMobile?.addEventListener('click', handleLogout);
      } else {
        // Utilisateur non connect√©
        profileLink?.classList.add('hidden');
        historiqueLink?.classList.add('hidden');
        suiviLink?.classList.add('hidden');
        logoutLink?.classList.add('hidden');
        loginLink?.classList.remove('hidden');
        
        profileLinkMobile?.classList.add('hidden');
        historiqueLinkMobile?.classList.add('hidden');
        suiviLinkMobile?.classList.add('hidden');
        logoutLinkMobile?.classList.add('hidden');
        loginLinkMobile?.classList.remove('hidden');
      }

      // =====================
      // MENU MOBILE
      // =====================
      const mobileMenuBtn = document.getElementById("mobile-menu-btn");
      const mobileMenu = document.getElementById("mobile-menu");

      if (mobileMenuBtn && mobileMenu) {
        mobileMenuBtn.addEventListener("click", () => {
          mobileMenu.classList.toggle("hidden");
        });

        const mobileLinks = mobileMenu.querySelectorAll("a");
        mobileLinks.forEach(link => {
          link.addEventListener("click", () => {
            mobileMenu.classList.add("hidden");
          });
        });
      }

      document.addEventListener("click", (e) => {
        if (mobileMenu && mobileMenuBtn) {
          if (!mobileMenu.contains(e.target) && !mobileMenuBtn.contains(e.target)) {
            mobileMenu.classList.add("hidden");
          }
        }
      });

      // =====================
      // GESTION DU PANIER
      // =====================
      let cart = JSON.parse(localStorage.getItem('cart')) || [];

      const cartBtn = document.getElementById('cart-btn');
      const closeCartBtn = document.getElementById('close-cart');
      const cartOverlay = document.getElementById('cart-overlay');
      const cartSidebar = document.getElementById('cart-sidebar');
      const cartCount = document.getElementById('cart-count');
      const cartItems = document.getElementById('cart-items');
      const emptyCart = document.getElementById('empty-cart');
      const cartSummary = document.getElementById('cart-summary');
      const cartTotal = document.getElementById('cart-total');
      const checkoutBtn = document.getElementById('checkout-btn');
      const continueShoppingBtn = document.getElementById('continue-shopping');

      function updateCartCount() {
        const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
        cartCount.textContent = totalItems;
      }

      function updateCartDisplay() {
        if (cart.length === 0) {
          emptyCart.classList.remove('hidden');
          cartItems.classList.add('hidden');
          cartSummary.classList.add('hidden');
        } else {
          emptyCart.classList.add('hidden');
          cartItems.classList.remove('hidden');
          cartSummary.classList.remove('hidden');

          cartItems.innerHTML = cart.map(item => `
            <div class="flex items-center space-x-4 py-4 border-b border-gray-200" data-product-id="${item.id}">
              <img src="${item.image}" alt="${item.name}" class="w-16 h-16 object-cover rounded">
              <div class="flex-1">
                <h3 class="font-semibold text-gray-800">${item.name}</h3>
                <p class="text-purple-600 font-bold">${item.price.toFixed(2)} FCFA</p>
                <div class="flex items-center space-x-2 mt-2">
                  <button class="decrease-qty text-gray-500 hover:text-purple-600" data-id="${item.id}">
                    <i class="fas fa-minus text-sm"></i>
                  </button>
                  <span class="quantity-display w-8 text-center">${item.quantity}</span>
                  <button class="increase-qty text-gray-500 hover:text-purple-600" data-id="${item.id}">
                    <i class="fas fa-plus text-sm"></i>
                  </button>
                  <button class="remove-item text-red-500 hover:text-red-700 ml-4" data-id="${item.id}">
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              </div>
            </div>
          `).join('');

          const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
          cartTotal.textContent = `${total.toFixed(2)} FCFA`;
        }

        updateCartCount();
      }

      function addToCart(product) {
        const existingItem = cart.find(item => item.id === product.id);
        const imageUrl = product.imagePath || 'https://via.placeholder.com/300x300?text=Image+non+disponible';

        if (existingItem) {
          existingItem.quantity += 1;
        } else {
          cart.push({
            id: product.id,
            name: product.nom,
            price: product.prix,
            image: imageUrl,
            quantity: 1
          });
        }

        localStorage.setItem('cart', JSON.stringify(cart));
        updateCartDisplay();
        showCartNotification('Produit ajout√© au panier !');
      }

      function removeFromCart(productId) {
        cart = cart.filter(item => item.id !== productId);
        localStorage.setItem('cart', JSON.stringify(cart));
        updateCartDisplay();
      }

      function updateQuantity(productId, change) {
        const item = cart.find(item => item.id === productId);
        if (item) {
          item.quantity += change;
          if (item.quantity <= 0) {
            removeFromCart(productId);
          } else {
            localStorage.setItem('cart', JSON.stringify(cart));
            updateCartDisplay();
          }
        }
      }

      function showCartNotification(message) {
        const toast = document.createElement('div');
        toast.className = 'fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 transform transition-transform duration-300';
        toast.textContent = message;
        document.body.appendChild(toast);

        setTimeout(() => toast.remove(), 3000);
      }

      cartBtn.addEventListener('click', () => {
        cartSidebar.classList.add('open');
        cartOverlay.classList.add('open');
        document.body.style.overflow = 'hidden';
      });

      closeCartBtn.addEventListener('click', closeCart);
      cartOverlay.addEventListener('click', closeCart);
      continueShoppingBtn.addEventListener('click', closeCart);

      function closeCart() {
        cartSidebar.classList.remove('open');
        cartOverlay.classList.remove('open');
        document.body.style.overflow = '';
      }

      cartItems.addEventListener('click', (e) => {
        const target = e.target.closest('button');
        if (!target) return;

        const productId = target.dataset.id;

        if (target.classList.contains('increase-qty')) {
          updateQuantity(productId, 1);
        } else if (target.classList.contains('decrease-qty')) {
          updateQuantity(productId, -1);
        } else if (target.classList.contains('remove-item')) {
          removeFromCart(productId);
        }
      });

      checkoutBtn.addEventListener('click', () => {
        if (cart.length === 0) return;

        if (!token) {
          alert('Veuillez vous connecter pour passer commande');
          window.location.href = '../utils/login.html';
          return;
        }

        window.location.href = './checkout.html';
      });

      // =====================
      // FONCTIONS PRODUITS
      // =====================
      async function loadProducts(sort = '', category = '') {
        try {
          let url = `https://luxeparfum-backend.onrender.com/api/products/genre/Femme`;
          const params = new URLSearchParams();
          if (sort) params.append('sort', sort);
          if (category) params.append('categorie', category);
          if (params.toString()) url += `?${params.toString()}`;

          const res = await fetch(url);
          if (!res.ok) throw new Error("Erreur API " + res.status);
          const data = await res.json();

          return Array.isArray(data) ? data : (Array.isArray(data.items) ? data.items : []);
        } catch (e) {
          console.error("Erreur de chargement :", e);
          return [];
        }
      }

      function createProductCard(product) {
        const img = product.imagePath || 'https://via.placeholder.com/300x300?text=Image+non+disponible';

        return `
          <div class="bg-white rounded-lg shadow-sm overflow-hidden hover:shadow-lg transition">
            <div class="h-64 overflow-hidden">
              <img src="${img}" alt="${product.nom}" class="w-full h-full object-cover">
            </div>
            <div class="p-4">
              <h3 class="font-bold text-gray-800">${product.nom}</h3>
              <p class="text-sm text-gray-500">${product.categorie?.nom || 'Non cat√©goris√©'}</p>
              <div class="mt-3 flex justify-between items-center">
                <span class="font-bold text-gray-800">${product.prix.toFixed(2)} FCFA</span>
                <button class="add-to-cart bg-purple-600 hover:bg-purple-700 text-white px-3 py-1 rounded-full text-sm transition duration-300" 
                        data-product='${JSON.stringify({ ...product, image: img }).replace(/'/g, "&#39;")}'>
                  <i class="fas fa-plus mr-1"></i> Ajouter
                </button>
              </div>
            </div>
          </div>`;
      }

      async function displayProducts() {
        const container = document.getElementById("productsContainer");
        const sort = document.getElementById("sortSelect").value;
        const category = document.getElementById("categorySelect").value;

        container.innerHTML = `
          <div class="col-span-full py-12 text-center text-gray-500">
            <i class="fas fa-spinner fa-spin text-3xl mb-3"></i>
            <p>Chargement des parfums...</p>
          </div>`;

        const products = await loadProducts(sort, category);

        if (!products.length) {
          container.innerHTML = `
            <div class="col-span-full text-center py-8 text-gray-500">
              <i class="fas fa-exclamation-circle text-3xl mb-3"></i>
              <p>Aucun parfum femme disponible.</p>
            </div>`;
          return;
        }

        container.innerHTML = products.map(p => createProductCard(p)).join('');

        document.querySelectorAll('.add-to-cart').forEach(button => {
          button.addEventListener('click', (e) => {
            const productData = JSON.parse(e.target.closest('button').dataset.product.replace(/&#39;/g, "'"));
            addToCart(productData);
          });
        });
      }

      document.getElementById("sortSelect").addEventListener("change", displayProducts);
      document.getElementById("categorySelect").addEventListener("change", displayProducts);

      updateCartDisplay();
      await displayProducts();
    });
  </script>
</body>

</html>